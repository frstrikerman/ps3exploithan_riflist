#!/usr/bin/env bash

mkdir ./.temp
a=`curl $1 | grep "\.rif" | sed 's/^.*href="\(.*\)\.rif".*$/\1/g' | sed 's/ /\n/g'`
sed -i '/option value=".*rif"/d' actrif_copier.html | grep "\.rif"
cd ./.temp
curl -O $1/"idps.hex"
curl -O $1/"act.dat"
for b in $(echo $a)
do
	curl -O $1/$b.rap 
	tmp=$(echo '<option value="'$b.rif'">'$b.rif'</option>')
	../PS3xploit-resigner-1.3.0/ps3xploit_rifgen_edatresign $b.rap
	sed -i "/put option here/a $tmp" $3
done
mv signed_act.dat "$2/act.dat"
mv *.rif $2/
cd ..
rm -Rf ./.temp
