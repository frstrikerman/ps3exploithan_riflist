#!/usr/bin/env bash

mkdir ./.temp
a=`curl $1 | grep "\.rap" | sed 's/^.*href="\(.*\)\.rap".*$/\1/g' | sed 's/ /\n/g'`
sed -i '/option value=".*rif"/d' ./html/actrif_copier.html
cd ./.temp
curl -O $1/"idps.hex"
curl -O $1/"act.dat"
for b in $(echo $a)
do
	curl -O $1/$b.rap 
	tmp=$(echo '<option value="'$b.rif'">'$b.rif'</option>')
	../PS3xploit-resigner/ps3xploit_rifgen_edatresign $b.rap
	sed -i "/put option here/a $tmp" ../html/actrif_copier.html
done
mv signed_act.dat "$2/act.dat"
mv *.rif $2/
cd ..
rm -Rf ./.temp
